
> ***@1.0.13 test
> jest __tests__/lib/rbac.test.js

FAIL __tests__/lib/rbac.test.js
  RBAC - requireRole
    âˆš should allow Admin for all roles (4 ms)
    âˆš should allow PM for PM-only roles (1 ms)
    Ã— should deny Vendor access to Admin routes (3 ms)
    âˆš should deny Finance User access to PM-only routes (1 ms)
    âˆš should allow Finance User access to Finance routes (1 ms)
  RBAC - checkPermission
    âˆš Admin should have all permissions (1 ms)
    âˆš PM should be able to approve assigned project invoices
    âˆš PM should NOT approve unassigned project invoices
    âˆš Vendor should be able to submit invoices (1 ms)
    âˆš Vendor should NOT manage users (1 ms)
    âˆš Finance User should be able to perform HIL review (1 ms)
    âˆš Finance User should be able to finalize payment (1 ms)
  RBAC - getVisibleFields
    âˆš Admin should see all invoice fields
    âˆš Vendor should see limited invoice fields (1 ms)
    âˆš PM should see project-relevant fields
  RBAC - canAccessRoute
    âˆš Admin should access /admin routes (1 ms)
    âˆš PM should access /pm routes (1 ms)
    âˆš PM should NOT access /admin routes (1 ms)
    âˆš Vendor should access /vendor routes (1 ms)
    âˆš Vendor should NOT access /finance routes
    âˆš Finance User should access /finance routes (1 ms)
  RBAC - getAllowedInvoiceActions
    âˆš Admin should have all invoice actions (1 ms)
    âˆš PM should have approve/reject for assigned projects (1 ms)
    âˆš Vendor should only VIEW own invoices (1 ms)
    Ã— Finance User should have approve for HIL-reviewed invoices (2 ms)

  â— RBAC - requireRole â€º should deny Vendor access to Admin routes

    expect(received).toContain(expected) // indexOf

    Expected substring: "not allowed"
    Received string:    "Role Vendor not authorized for this action"

    [0m [90m 32 |[39m         [36mconst[39m check [33m=[39m requireRole([[33mROLES[39m[33m.[39m[33mADMIN[39m])[33m;[39m
     [90m 33 |[39m         expect(check(vendorUser)[33m.[39mallowed)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 34 |[39m         expect(check(vendorUser)[33m.[39mreason)[33m.[39mtoContain([32m'not allowed'[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 35 |[39m     })[33m;[39m
     [90m 36 |[39m
     [90m 37 |[39m     test([32m'should deny Finance User access to PM-only routes'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toContain (__tests__/lib/rbac.test.js:34:42)

  â— RBAC - getAllowedInvoiceActions â€º Finance User should have approve for HIL-reviewed invoices

    expect(received).toContain(expected) // indexOf

    Expected value: "APPROVE"
    Received array: ["VIEW", "EDIT", "HIL_REVIEW", "FINAL_APPROVE", "FINAL_REJECT"]

    [0m [90m 198 |[39m         [36mconst[39m actions [33m=[39m getAllowedInvoiceActions(financeUser[33m,[39m invoice)[33m;[39m
     [90m 199 |[39m         expect(actions)[33m.[39mtoContain([32m'VIEW'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 200 |[39m         expect(actions)[33m.[39mtoContain([32m'APPROVE'[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 201 |[39m         expect(actions)[33m.[39mtoContain([32m'REJECT'[39m)[33m;[39m
     [90m 202 |[39m     })[33m;[39m
     [90m 203 |[39m })[33m;[39m[0m

      at Object.toContain (__tests__/lib/rbac.test.js:200:25)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 23 passed, 25 total
Snapshots:   0 total
Time:        0.821 s, estimated 2 s
Ran all test suites matching __tests__/lib/rbac.test.js.
