
> ***@1.0.13 test
> jest __tests__/lib/rbac.test.js

FAIL __tests__/lib/rbac.test.js
  RBAC - requireRole
    Ã— should allow Admin for all roles (10 ms)
    Ã— should allow PM for PM-only roles (2 ms)
    Ã— should deny Vendor access to Admin routes (4 ms)
    âˆš should deny Finance User access to PM-only routes (1 ms)
    Ã— should allow Finance User access to Finance routes (2 ms)
  RBAC - checkPermission
    âˆš Admin should have all permissions (2 ms)
    âˆš PM should be able to approve assigned project invoices (1 ms)
    âˆš PM should NOT approve unassigned project invoices (1 ms)
    âˆš Vendor should be able to submit invoices (1 ms)
    âˆš Vendor should NOT manage users (1 ms)
    âˆš Finance User should be able to perform HIL review (1 ms)
    Ã— Finance User should be able to finalize payment (1 ms)
  RBAC - getVisibleFields
    Ã— Admin should see all invoice fields (2 ms)
    âˆš Vendor should see limited invoice fields (1 ms)
    âˆš PM should see project-relevant fields (2 ms)
  RBAC - canAccessRoute
    Ã— Admin should access /admin routes (2 ms)
    Ã— PM should access /pm routes (1 ms)
    âˆš PM should NOT access /admin routes (1 ms)
    Ã— Vendor should access /vendor routes (2 ms)
    âˆš Vendor should NOT access /finance routes (1 ms)
    Ã— Finance User should access /finance routes (1 ms)
  RBAC - getAllowedInvoiceActions
    âˆš Admin should have all invoice actions (3 ms)
    âˆš PM should have approve/reject for assigned projects (2 ms)
    âˆš Vendor should only VIEW own invoices (1 ms)
    Ã— Finance User should have approve for HIL-reviewed invoices (1 ms)

  â— RBAC - requireRole â€º should allow Admin for all roles

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 19 |[39m         [36mconst[39m adminUser [33m=[39m { id[33m:[39m [32m'1'[39m[33m,[39m role[33m:[39m [33mROLES[39m[33m.[39m[33mADMIN[39m }[33m;[39m
     [90m 20 |[39m         [36mconst[39m check [33m=[39m requireRole([[33mROLES[39m[33m.[39m[33mADMIN[39m[33m,[39m [33mROLES[39m[33m.[39m[33mPROJECT_MANAGER[39m])[33m;[39m
    [31m[1m>[22m[39m[90m 21 |[39m         expect(check(adminUser)[33m.[39mallowed)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 22 |[39m     })[33m;[39m
     [90m 23 |[39m
     [90m 24 |[39m     test([32m'should allow PM for PM-only roles'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBe (__tests__/lib/rbac.test.js:21:42)

  â— RBAC - requireRole â€º should allow PM for PM-only roles

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 25 |[39m         [36mconst[39m pmUser [33m=[39m { id[33m:[39m [32m'2'[39m[33m,[39m role[33m:[39m [33mROLES[39m[33m.[39m[33mPROJECT_MANAGER[39m }[33m;[39m
     [90m 26 |[39m         [36mconst[39m check [33m=[39m requireRole([[33mROLES[39m[33m.[39m[33mPROJECT_MANAGER[39m])[33m;[39m
    [31m[1m>[22m[39m[90m 27 |[39m         expect(check(pmUser)[33m.[39mallowed)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 28 |[39m     })[33m;[39m
     [90m 29 |[39m
     [90m 30 |[39m     test([32m'should deny Vendor access to Admin routes'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBe (__tests__/lib/rbac.test.js:27:39)

  â— RBAC - requireRole â€º should deny Vendor access to Admin routes

    expect(received).toContain(expected) // indexOf

    Expected substring: "not allowed"
    Received string:    "User account is deactivated"

    [0m [90m 32 |[39m         [36mconst[39m check [33m=[39m requireRole([[33mROLES[39m[33m.[39m[33mADMIN[39m])[33m;[39m
     [90m 33 |[39m         expect(check(vendorUser)[33m.[39mallowed)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 34 |[39m         expect(check(vendorUser)[33m.[39mreason)[33m.[39mtoContain([32m'not allowed'[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 35 |[39m     })[33m;[39m
     [90m 36 |[39m
     [90m 37 |[39m     test([32m'should deny Finance User access to PM-only routes'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toContain (__tests__/lib/rbac.test.js:34:42)

  â— RBAC - requireRole â€º should allow Finance User access to Finance routes

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 44 |[39m         [36mconst[39m financeUser [33m=[39m { id[33m:[39m [32m'4'[39m[33m,[39m role[33m:[39m [33mROLES[39m[33m.[39m[33mFINANCE_USER[39m }[33m;[39m
     [90m 45 |[39m         [36mconst[39m check [33m=[39m requireRole([[33mROLES[39m[33m.[39m[33mFINANCE_USER[39m[33m,[39m [33mROLES[39m[33m.[39m[33mADMIN[39m])[33m;[39m
    [31m[1m>[22m[39m[90m 46 |[39m         expect(check(financeUser)[33m.[39mallowed)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                            [31m[1m^[22m[39m
     [90m 47 |[39m     })[33m;[39m
     [90m 48 |[39m })[33m;[39m
     [90m 49 |[39m[0m

      at Object.toBe (__tests__/lib/rbac.test.js:46:44)

  â— RBAC - checkPermission â€º Finance User should be able to finalize payment

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 93 |[39m     test([32m'Finance User should be able to finalize payment'[39m[33m,[39m () [33m=>[39m {
     [90m 94 |[39m         [36mconst[39m financeUser [33m=[39m { id[33m:[39m [32m'4'[39m[33m,[39m role[33m:[39m [33mROLES[39m[33m.[39m[33mFINANCE_USER[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 95 |[39m         expect(checkPermission(financeUser[33m,[39m [32m'FINALIZE_PAYMENT'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 96 |[39m     })[33m;[39m
     [90m 97 |[39m })[33m;[39m
     [90m 98 |[39m[0m

      at Object.toBe (__tests__/lib/rbac.test.js:95:66)

  â— RBAC - getVisibleFields â€º Admin should see all invoice fields

    expect(received).toContain(expected) // indexOf

    Expected value: "amount"
    Received array: ["*"]

    [0m [90m 100 |[39m     test([32m'Admin should see all invoice fields'[39m[33m,[39m () [33m=>[39m {
     [90m 101 |[39m         [36mconst[39m fields [33m=[39m getVisibleFields([33mROLES[39m[33m.[39m[33mADMIN[39m[33m,[39m [32m'invoice'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 102 |[39m         expect(fields)[33m.[39mtoContain([32m'amount'[39m)[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 103 |[39m         expect(fields)[33m.[39mtoContain([32m'financeApproval'[39m)[33m;[39m
     [90m 104 |[39m         expect(fields)[33m.[39mtoContain([32m'pmApproval'[39m)[33m;[39m
     [90m 105 |[39m         expect(fields)[33m.[39mtoContain([32m'hilReview'[39m)[33m;[39m[0m

      at Object.toContain (__tests__/lib/rbac.test.js:102:24)

  â— RBAC - canAccessRoute â€º Admin should access /admin routes

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 123 |[39m     test([32m'Admin should access /admin routes'[39m[33m,[39m () [33m=>[39m {
     [90m 124 |[39m         [36mconst[39m adminUser [33m=[39m { id[33m:[39m [32m'1'[39m[33m,[39m role[33m:[39m [33mROLES[39m[33m.[39m[33mADMIN[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 125 |[39m         expect(canAccessRoute(adminUser[33m,[39m [32m'/admin/users'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                           [31m[1m^[22m[39m
     [90m 126 |[39m         expect(canAccessRoute(adminUser[33m,[39m [32m'/admin/ratecards'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 127 |[39m     })[33m;[39m
     [90m 128 |[39m[0m

      at Object.toBe (__tests__/lib/rbac.test.js:125:59)

  â— RBAC - canAccessRoute â€º PM should access /pm routes

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 129 |[39m     test([32m'PM should access /pm routes'[39m[33m,[39m () [33m=>[39m {
     [90m 130 |[39m         [36mconst[39m pmUser [33m=[39m { id[33m:[39m [32m'2'[39m[33m,[39m role[33m:[39m [33mROLES[39m[33m.[39m[33mPROJECT_MANAGER[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 131 |[39m         expect(canAccessRoute(pmUser[33m,[39m [32m'/pm/documents'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 132 |[39m         expect(canAccessRoute(pmUser[33m,[39m [32m'/pm/approvals'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 133 |[39m     })[33m;[39m
     [90m 134 |[39m[0m

      at Object.toBe (__tests__/lib/rbac.test.js:131:57)

  â— RBAC - canAccessRoute â€º Vendor should access /vendor routes

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 140 |[39m     test([32m'Vendor should access /vendor routes'[39m[33m,[39m () [33m=>[39m {
     [90m 141 |[39m         [36mconst[39m vendorUser [33m=[39m { id[33m:[39m [32m'3'[39m[33m,[39m role[33m:[39m [33mROLES[39m[33m.[39m[33mVENDOR[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 142 |[39m         expect(canAccessRoute(vendorUser[33m,[39m [32m'/vendor/submit'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                              [31m[1m^[22m[39m
     [90m 143 |[39m         expect(canAccessRoute(vendorUser[33m,[39m [32m'/vendor/invoices'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 144 |[39m     })[33m;[39m
     [90m 145 |[39m[0m

      at Object.toBe (__tests__/lib/rbac.test.js:142:62)

  â— RBAC - canAccessRoute â€º Finance User should access /finance routes

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 151 |[39m     test([32m'Finance User should access /finance routes'[39m[33m,[39m () [33m=>[39m {
     [90m 152 |[39m         [36mconst[39m financeUser [33m=[39m { id[33m:[39m [32m'4'[39m[33m,[39m role[33m:[39m [33mROLES[39m[33m.[39m[33mFINANCE_USER[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 153 |[39m         expect(canAccessRoute(financeUser[33m,[39m [32m'/finance/hil-review'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 154 |[39m         expect(canAccessRoute(financeUser[33m,[39m [32m'/finance/approval-queue'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 155 |[39m     })[33m;[39m
     [90m 156 |[39m })[33m;[39m[0m

      at Object.toBe (__tests__/lib/rbac.test.js:153:68)

  â— RBAC - getAllowedInvoiceActions â€º Finance User should have approve for HIL-reviewed invoices

    expect(received).toContain(expected) // indexOf

    Expected value: "APPROVE"
    Received array: ["VIEW", "EDIT", "HIL_REVIEW", "FINAL_APPROVE", "FINAL_REJECT"]

    [0m [90m 198 |[39m         [36mconst[39m actions [33m=[39m getAllowedInvoiceActions(financeUser[33m,[39m invoice)[33m;[39m
     [90m 199 |[39m         expect(actions)[33m.[39mtoContain([32m'VIEW'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 200 |[39m         expect(actions)[33m.[39mtoContain([32m'APPROVE'[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 201 |[39m         expect(actions)[33m.[39mtoContain([32m'REJECT'[39m)[33m;[39m
     [90m 202 |[39m     })[33m;[39m
     [90m 203 |[39m })[33m;[39m[0m

      at Object.toContain (__tests__/lib/rbac.test.js:200:25)

Test Suites: 1 failed, 1 total
Tests:       11 failed, 14 passed, 25 total
Snapshots:   0 total
Time:        1.093 s, estimated 2 s
Ran all test suites matching __tests__/lib/rbac.test.js.
